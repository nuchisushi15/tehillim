import React, { useState, useEffect } from 'react';
import { Book, Mail, Check, User, Clock, Heart, Plus, Copy, Bell } from 'lucide-react';

const TehillimTracker = () => {
  const [campaigns, setCampaigns] = useState({});
  const [currentCampaign, setCurrentCampaign] = useState(null);
  const [showCreateForm, setShowCreateForm] = useState(false);
  const [selectedChapters, setSelectedChapters] = useState([]);
  const [userName, setUserName] = useState('');
  const [userEmail, setUserEmail] = useState('');
  const [showChapterText, setShowChapterText] = useState(null);
  const [emailSent, setEmailSent] = useState(false);
  const [linkCopied, setLinkCopied] = useState(false);

  // New campaign form state
  const [campaignName, setCampaignName] = useState('');
  const [prayerFor, setPrayerFor] = useState('');
  const [creatorName, setCreatorName] = useState('');
  const [creatorEmail, setCreatorEmail] = useState('');

  // Check URL for campaign ID
  useEffect(() => {
    const urlParams = new URLSearchParams(window.location.search);
    const campaignId = urlParams.get('campaign');
    if (campaignId && campaigns[campaignId]) {
      setCurrentCampaign(campaignId);
    }
  }, [campaigns]);

  // Sample chapter text
  const chapterTexts = {
    1: `×ª×”×™×œ×™× ×
× ×Ö·×©Ö°××¨Öµ×™ ×”Ö¸×Ö´×™×©× ×Ö²×©Ö¶××¨ ×œÖ¹× ×”Ö¸×œÖ·×šÖ° ×‘Ö·Ö¼×¢Ö²×¦Ö·×ª ×¨Ö°×©Ö¸××¢Ö´×™× ×•Ö¼×‘Ö°×“Ö¶×¨Ö¶×šÖ° ×—Ö·×˜Ö¸Ö¼×Ö´×™× ×œÖ¹× ×¢Ö¸×Ö¸×“ ×•Ö¼×‘Ö°××•Ö¹×©Ö·××‘ ×œÖµ×¦Ö´×™× ×œÖ¹× ×™Ö¸×©Ö¸××‘
×‘ ×›Ö´Ö¼×™ ×Ö´× ×‘Ö°Ö¼×ª×•Ö¹×¨Ö·×ª ×™Ö°×”×•Ö¸×” ×—Ö¶×¤Ö°×¦×•Ö¹ ×•Ö¼×‘Ö°×ª×•Ö¹×¨Ö¸×ª×•Ö¹ ×™Ö¶×”Ö°×’Ö¶Ö¼×” ×™×•Ö¹×Ö¸× ×•Ö¸×œÖ¸×™Ö°×œÖ¸×”
×’ ×•Ö°×”Ö¸×™Ö¸×” ×›Ö°Ö¼×¢Öµ×¥ ×©Ö¸××ª×•Ö¼×œ ×¢Ö·×œ ×¤Ö·Ö¼×œÖ°×’Öµ×™ ×Ö¸×™Ö´× ×Ö²×©Ö¶××¨ ×¤Ö´Ö¼×¨Ö°×™×•Ö¹ ×™Ö´×ªÖµÖ¼×Ÿ ×‘Ö°Ö¼×¢Ö´×ªÖ¼×•Ö¹ ×•Ö°×¢Ö¸×œÖµ×”×•Ö¼ ×œÖ¹× ×™Ö´×‘Ö¼×•Ö¹×œ ×•Ö°×›Ö¹×œ ×Ö²×©Ö¶××¨ ×™Ö·×¢Ö²×©Ö¶×‚×” ×™Ö·×¦Ö°×œÖ´×™×—Ö·
×“ ×œÖ¹× ×›Öµ×Ÿ ×”Ö¸×¨Ö°×©Ö¸××¢Ö´×™× ×›Ö´Ö¼×™ ×Ö´× ×›Ö·Ö¼×Ö¹Ö¼×¥ ×Ö²×©Ö¶××¨ ×ªÖ´Ö¼×“Ö°Ö¼×¤Ö¶× Ö¼×•Ö¼ ×¨×•Ö¼×—Ö·
×” ×¢Ö·×œ ×›ÖµÖ¼×Ÿ ×œÖ¹× ×™Ö¸×§Ö»××•Ö¼ ×¨Ö°×©Ö¸××¢Ö´×™× ×‘Ö·Ö¼×Ö´Ö¼×©Ö°××¤Ö¸Ö¼×˜ ×•Ö°×—Ö·×˜Ö¸Ö¼×Ö´×™× ×‘Ö·Ö¼×¢Ö²×“Ö·×ª ×¦Ö·×“Ö´Ö¼×™×§Ö´×™×
×• ×›Ö´Ö¼×™ ×™×•Ö¹×“Öµ×¢Ö· ×™Ö°×”×•Ö¸×” ×“Ö¶Ö¼×¨Ö¶×šÖ° ×¦Ö·×“Ö´Ö¼×™×§Ö´×™× ×•Ö°×“Ö¶×¨Ö¶×šÖ° ×¨Ö°×©Ö¸××¢Ö´×™× ×ªÖ¹Ö¼××‘Öµ×“`,
    23: `×ª×”×™×œ×™× ×›×’
× ×Ö´×–Ö°××•Ö¹×¨ ×œÖ°×“Ö¸×•Ö´×“ ×™Ö°×”×•Ö¸×” ×¨Ö¹×¢Ö´×™ ×œÖ¹× ×Ö¶×—Ö°×¡Ö¸×¨
×‘ ×‘Ö´Ö¼× Ö°××•Ö¹×ª ×“Ö¶Ö¼×©Ö¶×× ×™Ö·×¨Ö°×‘Ö´Ö¼×™×¦Öµ× Ö´×™ ×¢Ö·×œ ×Öµ×™ ×Ö°× Ö»×—×•Ö¹×ª ×™Ö°× Ö·×”Ö²×œÖµ× Ö´×™
×’ × Ö·×¤Ö°×©Ö´××™ ×™Ö°×©××•Ö¹×‘Öµ×‘ ×™Ö·× Ö°×—Öµ× Ö´×™ ×‘Ö°×Ö·×¢Ö°×’Ö°Ö¼×œÖµ×™ ×¦Ö¶×“Ö¶×§ ×œÖ°×Ö·×¢Ö·×Ÿ ×©Ö°×××•Ö¹
×“ ×’Ö·Ö¼× ×›Ö´Ö¼×™ ×Öµ×œÖµ×šÖ° ×‘Ö°Ö¼×’Öµ×™× ×¦Ö·×œÖ°×Ö¸×•Ö¶×ª ×œÖ¹× ×Ö´×™×¨Ö¸× ×¨Ö¸×¢ ×›Ö´Ö¼×™ ×Ö·×ªÖ¸Ö¼×” ×¢Ö´×Ö¸Ö¼×“Ö´×™ ×©Ö´××‘Ö°×˜Ö°×šÖ¸ ×•Ö¼×Ö´×©Ö°××¢Ö·× Ö°×ªÖ¶Ö¼×šÖ¸ ×”Öµ×Ö¸Ö¼×” ×™Ö°× Ö·×—Ö²×Ö»× Ö´×™
×” ×ªÖ·Ö¼×¢Ö²×¨Ö¹×šÖ° ×œÖ°×¤Ö¸× Ö·×™ ×©Ö»××œÖ°×—Ö¸×Ÿ × Ö¶×’Ö¶×“ ×¦Ö¹×¨Ö°×¨Ö¸×™ ×“Ö´Ö¼×©Ö·Ö¼×× Ö°×ªÖ¸Ö¼ ×‘Ö·×©Ö¶Ö¼××Ö¶×Ÿ ×¨Ö¹××©Ö´××™ ×›Ö¼×•Ö¹×¡Ö´×™ ×¨Ö°×•Ö¸×™Ö¸×”
×• ×Ö·×šÖ° ×˜×•Ö¹×‘ ×•Ö¸×—Ö¶×¡Ö¶×“ ×™Ö´×¨Ö°×“Ö°Ö¼×¤×•Ö¼× Ö´×™ ×›Ö¸Ö¼×œ ×™Ö°×Öµ×™ ×—Ö·×™Ö¸Ö¼×™ ×•Ö°×©Ö·××‘Ö°×ªÖ´Ö¼×™ ×‘Ö°Ö¼×‘Öµ×™×ª ×™Ö°×”×•Ö¸×” ×œÖ°×Ö¹×¨Ö¶×šÖ° ×™Ö¸×Ö´×™×`
  };

  const generateCampaignId = () => {
    return Math.random().toString(36).substr(2, 9);
  };

  const createNewCampaign = () => {
    if (!campaignName || !prayerFor || !creatorName || !creatorEmail) {
      alert('× × ×œ××œ× ××ª ×›×œ ×”×©×“×•×ª');
      return;
    }

    const campaignId = generateCampaignId();
    const newCampaign = {
      id: campaignId,
      name: campaignName,
      prayerFor: prayerFor,
      creatorName: creatorName,
      creatorEmail: creatorEmail,
      createdAt: new Date().toLocaleString('he-IL'),
      chapters: {}
    };

    // Initialize all 150 chapters
    for (let i = 1; i <= 150; i++) {
      newCampaign.chapters[i] = {
        id: i,
        available: true,
        takenBy: '',
        email: '',
        completed: false,
        takenAt: null
      };
    }

    setCampaigns(prev => ({
      ...prev,
      [campaignId]: newCampaign
    }));

    setCurrentCampaign(campaignId);
    setShowCreateForm(false);
    
    // Reset form
    setCampaignName('');
    setPrayerFor('');
    setCreatorName('');
    setCreatorEmail('');

    // Update URL
    window.history.pushState({}, '', `?campaign=${campaignId}`);
  };

  const getCurrentCampaignData = () => {
    return currentCampaign ? campaigns[currentCampaign] : null;
  };

  const handleChapterSelect = (chapterNum) => {
    const campaignData = getCurrentCampaignData();
    if (!campaignData || !campaignData.chapters[chapterNum].available) return;
    
    if (selectedChapters.includes(chapterNum)) {
      setSelectedChapters(selectedChapters.filter(ch => ch !== chapterNum));
    } else {
      setSelectedChapters([...selectedChapters, chapterNum]);
    }
  };

  const handleClaimChapters = () => {
    if (!userName || !userEmail || selectedChapters.length === 0) {
      alert('× × ×œ××œ× ×©×, ××™××™×™×œ ×•×œ×‘×—×•×¨ ×œ×¤×—×•×ª ×¤×¨×§ ××—×“');
      return;
    }

    const campaignData = getCurrentCampaignData();
    if (!campaignData) return;

    const updatedCampaigns = { ...campaigns };
    selectedChapters.forEach(chapterNum => {
      updatedCampaigns[currentCampaign].chapters[chapterNum] = {
        ...updatedCampaigns[currentCampaign].chapters[chapterNum],
        available: false,
        takenBy: userName,
        email: userEmail,
        takenAt: new Date().toLocaleString('he-IL')
      };
    });

    setCampaigns(updatedCampaigns);
    
    // Simulate sending email to participant
    setTimeout(() => {
      setEmailSent(true);
      setTimeout(() => setEmailSent(false), 3000);
    }, 1000);

    // Simulate sending notification to campaign creator
    setTimeout(() => {
      console.log(`ğŸ“§ Notification sent to ${campaignData.creatorEmail}: ${userName} took chapters ${selectedChapters.join(', ')} for ${campaignData.prayerFor}`);
    }, 500);

    setSelectedChapters([]);
    setUserName('');
    setUserEmail('');
  };

  const handleCompleteChapter = (chapterNum) => {
    const updatedCampaigns = { ...campaigns };
    updatedCampaigns[currentCampaign].chapters[chapterNum] = {
      ...updatedCampaigns[currentCampaign].chapters[chapterNum],
      completed: true
    };
    setCampaigns(updatedCampaigns);

    // Notify campaign creator about completion
    const campaignData = getCurrentCampaignData();
    setTimeout(() => {
      console.log(`ğŸ“§ Completion notification sent to ${campaignData.creatorEmail}: Chapter ${chapterNum} completed for ${campaignData.prayerFor}`);
    }, 500);
  };

  const copyLink = () => {
    const link = `${window.location.origin}${window.location.pathname}?campaign=${currentCampaign}`;
    navigator.clipboard.writeText(link);
    setLinkCopied(true);
    setTimeout(() => setLinkCopied(false), 2000);
  };

  const campaignData = getCurrentCampaignData();

  // Campaign selection/creation screen
  if (!currentCampaign) {
    return (
      <div className="max-w-4xl mx-auto p-6 bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
        <div className="text-center mb-8">
          <h1 className="text-4xl font-bold text-indigo-900 mb-2 flex items-center justify-center gap-2">
            <Book className="text-indigo-600" />
            ××¢×¨×›×ª ×ª×”×™×œ×™× ×§×”×™×œ×ª×™×ª
          </h1>
          <p className="text-lg text-indigo-700">×¦×•×¨ ××¡×¢ ×ª×”×™×œ×™× ×—×“×© ××• ×”×¦×˜×¨×£ ×œ×§×™×™×</p>
        </div>

        <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
          {/* Create New Campaign */}
          <div className="bg-white rounded-lg shadow-lg p-6">
            <h2 className="text-2xl font-bold text-indigo-900 mb-4 flex items-center gap-2">
              <Plus className="w-6 h-6" />
              ×¦×•×¨ ××¡×¢ ×ª×”×™×œ×™× ×—×“×©
            </h2>
            
            {!showCreateForm ? (
              <div className="text-center py-8">
                <p className="text-gray-600 mb-4">×¦×•×¨ ××¡×¢ ×ª×”×™×œ×™× ××•×ª×× ××™×©×™×ª ×¢× ×§×™×©×•×¨ ×™×™×—×•×“×™</p>
                <button
                  onClick={() => setShowCreateForm(true)}
                  className="px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 flex items-center gap-2 mx-auto"
                >
                  <Plus className="w-5 h-5" />
                  ×¦×•×¨ ××¡×¢ ×—×“×©
                </button>
              </div>
            ) : (
              <div className="space-y-4">
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">×©× ×”××¡×¢</label>
                  <input
                    type="text"
                    value={campaignName}
                    onChange={(e) => setCampaignName(e.target.value)}
                    className="w-full p-3 border border-gray-300 rounded-md"
                    placeholder="×œ×“×•×’××”: ×ª×”×™×œ×™× ×œ×¨×¤×•××ª ×—×•×œ×™×"
                  />
                </div>
                
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">×œ××™ ×× ×—× ×• ××ª×¤×œ×œ×™×?</label>
                  <input
                    type="text"
                    value={prayerFor}
                    onChange={(e) => setPrayerFor(e.target.value)}
                    className="w-full p-3 border border-gray-300 rounded-md"
                    placeholder="×œ×“×•×’××”: ×™×•×¡×£ ×‘×Ÿ ××¨×™×, ×©×¨×” ×‘×ª ×¨×—×œ"
                  />
                </div>
                
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">×”×©× ×©×œ×š</label>
                  <input
                    type="text"
                    value={creatorName}
                    onChange={(e) => setCreatorName(e.target.value)}
                    className="w-full p-3 border border-gray-300 rounded-md"
                    placeholder="×”×©× ×©×œ×š"
                  />
                </div>
                
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">×”××™××™×™×œ ×©×œ×š</label>
                  <input
                    type="email"
                    value={creatorEmail}
                    onChange={(e) => setCreatorEmail(e.target.value)}
                    className="w-full p-3 border border-gray-300 rounded-md"
                    placeholder="×ª×§×‘×œ ×”×ª×¨××•×ª ×›×©××™×©×”×• ×œ×•×§×— ×¤×¨×§"
                  />
                </div>
                
                <div className="flex gap-2 pt-4">
                  <button
                    onClick={createNewCampaign}
                    className="flex-1 bg-indigo-600 text-white p-3 rounded-md hover:bg-indigo-700"
                  >
                    ×¦×•×¨ ××¡×¢
                  </button>
                  <button
                    onClick={() => setShowCreateForm(false)}
                    className="px-6 bg-gray-300 text-gray-700 p-3 rounded-md hover:bg-gray-400"
                  >
                    ×‘×™×˜×•×œ
                  </button>
                </div>
              </div>
            )}
          </div>

          {/* Existing Campaigns */}
          <div className="bg-white rounded-lg shadow-lg p-6">
            <h2 className="text-2xl font-bold text-indigo-900 mb-4 flex items-center gap-2">
              <Book className="w-6 h-6" />
              ××¡×¢×•×ª ×ª×”×™×œ×™× ×¤×¢×™×œ×™×
            </h2>
            
            {Object.keys(campaigns).length === 0 ? (
              <div className="text-center py-8">
                <p className="text-gray-600 mb-4">××™×Ÿ ××¡×¢×•×ª ×¤×¢×™×œ×™× ×›×¨×’×¢</p>
                <p className="text-sm text-gray-500">×¦×•×¨ ××¡×¢ ×—×“×© ××• ×”×–×Ÿ ×§×™×©×•×¨ ×œ××¡×¢ ×§×™×™×</p>
              </div>
            ) : (
              <div className="space-y-3">
                {Object.values(campaigns).map(campaign => {
                  const completedCount = Object.values(campaign.chapters).filter(ch => ch.completed).length;
                  const takenCount = Object.values(campaign.chapters).filter(ch => !ch.available && !ch.completed).length;
                  
                  return (
                    <div key={campaign.id} className="p-4 border border-gray-200 rounded-lg hover:bg-gray-50">
                      <div className="flex justify-between items-start mb-2">
                        <div>
                          <h3 className="font-semibold text-lg">{campaign.name}</h3>
                          <p className="text-indigo-600">×¢×‘×•×¨: {campaign.prayerFor}</p>
                          <p className="text-sm text-gray-500">× ×•×¦×¨ ×¢×œ ×™×“×™: {campaign.creatorName}</p>
                        </div>
                        <button
                          onClick={() => setCurrentCampaign(campaign.id)}
                          className="px-4 py-2 bg-indigo-100 text-indigo-700 rounded-md hover:bg-indigo-200"
                        >
                          ×”×¦×˜×¨×£
                        </button>
                      </div>
                      <div className="text-sm text-gray-600">
                        ×”×•×©×œ××•: {completedCount} | × ×œ×§×—×•: {takenCount} | ×–××™× ×™×: {150 - completedCount - takenCount}
                      </div>
                    </div>
                  );
                })}
              </div>
            )}
          </div>
        </div>
      </div>
    );
  }

  // Main campaign screen
  const availableCount = Object.values(campaignData.chapters).filter(ch => ch.available).length;
  const takenCount = Object.values(campaignData.chapters).filter(ch => !ch.available && !ch.completed).length;
  const completedCount = Object.values(campaignData.chapters).filter(ch => ch.completed).length;

  return (
    <div className="max-w-6xl mx-auto p-6 bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
      <div className="text-center mb-6">
        <button
          onClick={() => setCurrentCampaign(null)}
          className="mb-4 text-indigo-600 hover:text-indigo-800 underline"
        >
          â† ×—×–×•×¨ ×œ××¡×¢×•×ª
        </button>
        
        <h1 className="text-3xl font-bold text-indigo-900 mb-2">
          {campaignData.name}
        </h1>
        <p className="text-xl text-indigo-700 mb-1">
          ×ª×”×™×œ×™× ×¢×‘×•×¨: <span className="font-semibold">{campaignData.prayerFor}</span>
        </p>
        <p className="text-sm text-gray-600 mb-4">
          × ×•×¦×¨ ×¢×œ ×™×“×™ {campaignData.creatorName} ×‘-{campaignData.createdAt}
        </p>
        
        <div className="flex justify-center gap-2 mb-4">
          <button
            onClick={copyLink}
            className="flex items-center gap-2 px-4 py-2 bg-green-100 text-green-700 rounded-md hover:bg-green-200"
          >
            {linkCopied ? <Check className="w-4 h-4" /> : <Copy className="w-4 h-4" />}
            {linkCopied ? '×”×§×™×©×•×¨ ×”×•×¢×ª×§!' : '×”×¢×ª×§ ×§×™×©×•×¨'}
          </button>
        </div>
      </div>

      {emailSent && (
        <div className="mb-6 p-4 bg-green-100 border border-green-400 rounded-lg text-center">
          <div className="flex items-center justify-center gap-2 text-green-800">
            <Mail className="w-5 h-5" />
            <span>×”××™××™×™×œ × ×©×œ×— ×‘×”×¦×œ×—×” ×¢× ×”×¤×¨×§×™× ×©×‘×—×¨×ª!</span>
          </div>
        </div>
      )}

      <div className="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
        <div className="bg-green-100 p-4 rounded-lg text-center">
          <div className="text-2xl font-bold text-green-800">{availableCount}</div>
          <div className="text-green-700">×¤×¨×§×™× ×–××™× ×™×</div>
        </div>
        <div className="bg-yellow-100 p-4 rounded-lg text-center">
          <div className="text-2xl font-bold text-yellow-800">{takenCount}</div>
          <div className="text-yellow-700">×¤×¨×§×™× ×©× ×œ×§×—×•</div>
        </div>
        <div className="bg-blue-100 p-4 rounded-lg text-center">
          <div className="text-2xl font-bold text-blue-800">{completedCount}</div>
          <div className="text-blue-700">×¤×¨×§×™× ×©×”×•×©×œ××•</div>
        </div>
      </div>

      <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
        <h2 className="text-xl font-semibold text-indigo-900 mb-4">×‘×—×¨ ×¤×¨×§×™×</h2>
        
        <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1">×©×</label>
            <input
              type="text"
              value={userName}
              onChange={(e) => setUserName(e.target.value)}
              className="w-full p-2 border border-gray-300 rounded-md"
              placeholder="×”×›× ×¡ ×©×"
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1">××™××™×™×œ</label>
            <input
              type="email"
              value={userEmail}
              onChange={(e) => setUserEmail(e.target.value)}
              className="w-full p-2 border border-gray-300 rounded-md"
              placeholder="×”×›× ×¡ ××™××™×™×œ"
            />
          </div>
          <div className="flex items-end">
            <button
              onClick={handleClaimChapters}
              disabled={selectedChapters.length === 0 || !userName || !userEmail}
              className="w-full bg-indigo-600 text-white p-2 rounded-md hover:bg-indigo-700 disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center justify-center gap-2"
            >
              <Bell className="w-4 h-4" />
              ×§×— ×¤×¨×§×™× ({selectedChapters.length})
            </button>
          </div>
        </div>

        <div className="grid grid-cols-10 gap-2">
          {Object.values(campaignData.chapters).map(chapter => (
            <button
              key={chapter.id}
              onClick={() => handleChapterSelect(chapter.id)}
              className={`
                p-2 rounded-md text-sm font-medium transition-colors
                ${chapter.completed ? 'bg-blue-500 text-white cursor-default' :
                  !chapter.available ? 'bg-yellow-400 text-gray-800 cursor-default' :
                  selectedChapters.includes(chapter.id) ? 'bg-indigo-600 text-white' :
                  'bg-green-100 hover:bg-green-200 text-green-800'}
              `}
              disabled={!chapter.available}
              title={
                chapter.completed ? `×”×•×©×œ× ×¢×œ ×™×“×™ ${chapter.takenBy}` :
                !chapter.available ? `× ×œ×§×— ×¢×œ ×™×“×™ ${chapter.takenBy}` :
                '×–××™×Ÿ'
              }
            >
              {chapter.id}
              {chapter.completed && <Check className="w-3 h-3 inline ml-1" />}
              {!chapter.available && !chapter.completed && <Clock className="w-3 h-3 inline ml-1" />}
            </button>
          ))}
        </div>
      </div>

      <div className="bg-white rounded-lg shadow-lg p-6">
        <h2 className="text-xl font-semibold text-indigo-900 mb-4">×¤×¨×§×™× ×©× ×œ×§×—×•</h2>
        
        {Object.values(campaignData.chapters).filter(ch => !ch.available).length === 0 ? (
          <p className="text-gray-600 text-center py-4">××™×Ÿ ×¤×¨×§×™× ×©× ×œ×§×—×• ×¢×“×™×™×Ÿ</p>
        ) : (
          <div className="space-y-3">
            {Object.values(campaignData.chapters)
              .filter(ch => !ch.available)
              .sort((a, b) => a.id - b.id)
              .map(chapter => (
                <div key={chapter.id} className={`
                  p-4 rounded-lg border-2 transition-all
                  ${chapter.completed ? 'border-blue-200 bg-blue-50' : 'border-yellow-200 bg-yellow-50'}
                `}>
                  <div className="flex items-center justify-between">
                    <div className="flex items-center gap-3">
                      <span className="font-bold text-lg">×¤×¨×§ {chapter.id}</span>
                      <div className="flex items-center gap-1 text-gray-600">
                        <User className="w-4 h-4" />
                        <span>{chapter.takenBy}</span>
                      </div>
                      <div className="text-sm text-gray-500">
                        × ×œ×§×—: {chapter.takenAt}
                      </div>
                      {chapter.completed && (
                        <div className="flex items-center gap-1 text-blue-600">
                          <Check className="w-4 h-4" />
                          <span className="text-sm">×”×•×©×œ×</span>
                        </div>
                      )}
                    </div>
                    
                    <div className="flex gap-2">
                      <button
                        onClick={() => setShowChapterText(chapter.id)}
                        className="px-3 py-1 bg-indigo-100 text-indigo-700 rounded-md hover:bg-indigo-200 text-sm"
                      >
                        ×”×¦×’ ×˜×§×¡×˜
                      </button>
                      {!chapter.completed && (
                        <button
                          onClick={() => handleCompleteChapter(chapter.id)}
                          className="px-3 py-1 bg-green-100 text-green-700 rounded-md hover:bg-green-200 text-sm"
                        >
                          ×¡×™×™××ª×™
                        </button>
                      )}
                    </div>
                  </div>
                </div>
              ))
            }
          </div>
        )}
      </div>

      {showChapterText && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
          <div className="bg-white rounded-lg p-6 max-w-2xl max-h-96 overflow-y-auto">
            <div className="flex justify-between items-center mb-4">
              <h3 className="text-xl font-bold">×¤×¨×§ {showChapterText}</h3>
              <button
                onClick={() => setShowChapterText(null)}
                className="text-gray-500 hover:text-gray-700 text-2xl"
              >
                Ã—
              </button>
            </div>
            <div className="text-right leading-relaxed whitespace-pre-line font-hebrew">
              {chapterTexts[showChapterText] || `×˜×§×¡×˜ ×©×œ ×¤×¨×§ ${showChapterText} ×™×•×¦×’ ×›××Ÿ...`}
            </div>
            <div className="mt-4 text-center">
              <button
                onClick={() => handleCompleteChapter(showChapterText)}
                className="px-6 py-2 bg-green-600 text-white rounded-md hover:bg-green-700"
              >
                <Check className="w-4 h-4 inline mr-2" />
                ×¡×™×™××ª×™ ××ª ×”×¤×¨×§
              </button>
            </div>
          </div>
        </div>
      )}

      <div className="text-center mt-8 text-gray-600 text-sm">
        <Heart className="w-4 h-4 inline text-red-500 mr-1" />
        × ×•×¦×¨ ×œ×–×›×•×ª ×”×¨×‘×™× â€¢ ××ª×¤×œ×œ×™× ×¢×‘×•×¨ {campaignData.prayerFor}
      </div>
    </div>
  );
};

export default TehillimTracker;
